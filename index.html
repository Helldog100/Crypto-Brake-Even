
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Crypto Break-Even Calculator</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f4f7f9;
      max-width: 480px;
      margin: auto;
      transition: background-color 0.3s, color 0.3s;
    }
    body.dark {
      background-color: #121212;
      color: #e0e0e0;
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      margin-top: 5px;
      border-radius: 6px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    .result {
      margin-top: 15px;
      background: white;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      font-weight: 600;
      font-size: 1.1em;
      text-align: center;
    }
    body.dark .result, body.dark input, body.dark select, body.dark button {
      background-color: #1e1e1e;
      color: #e0e0e0;
    }
    .chart-container {
      margin-top: 20px;
      height: 350px;
    }
    .toggle-container {
      text-align: center;
      margin-top: 10px;
    }
    .range-buttons {
      display: flex;
      gap: 5px;
      justify-content: center;
      margin-top: 10px;
    }
    .range-buttons button {
      flex: 1;
      background: #eee;
    }
    body.dark .range-buttons button {
      background: #2e2e2e;
    }
  </style>
</head>
<body>
  <h2>Crypto Break-Even Calculator</h2>

  <label for="currencySelect">Currency:</label>
  <select id="currencySelect">
    <option value="usd">USD</option>
    <option value="gbp">GBP</option>
    <option value="eur">EUR</option>
    <option value="jpy">JPY</option>
    <option value="aud">AUD</option>
  </select><br><br>

  <label for="coinSelect">Select Coin:</label>
  <select id="coinSelect">
    <option value="bitcoin">Bitcoin (BTC)</option>
    <option value="ripple">Ripple (XRP)</option>
    <option value="dogecoin">Dogecoin (DOGE)</option>
    <option value="pepe">Pepe (PEPE)</option>
  </select>

  <div class="result">Current Price: <span id="priceOutput">Loadingâ€¦</span></div>

  <label for="exchangeSelect">Select Platform:</label>
  <select id="exchangeSelect">
    <option value="">Custom / Manual</option>
    <option value="crypto">Crypto.com</option>
    <option value="kraken">Kraken Pro</option>
    <option value="binance">Binance</option>
    <option value="coinbase">Coinbase Pro</option>
    <option value="kucoin">KuCoin</option>
    <option value="nexo">Nexo</option>
  </select>

  <label>Buy Price</label>
  <input type="number" id="buyPrice" step="any" oninput="calculate()">

  <label>Maker Fee (%)</label>
  <input type="number" id="makerFee" step="any" value="0.25" oninput="calculate()">

  <label>Taker Fee (%)</label>
  <input type="number" id="takerFee" step="any" value="0.50" oninput="calculate()">

  <label>Desired Profit (%)</label>
  <input type="number" id="profitTarget" step="any" value="0" oninput="calculate()">

  <label>Coin Quantity</label>
  <input type="number" id="coinQty" step="any" value="1" oninput="calculate()">

  <div class="toggle-container">
    <label><input type="checkbox" id="darkModeToggle" /> Enable Dark Mode</label>
  </div>

  <div class="result" id="marketResult"></div>
  <div class="result" id="limitResult"></div>
  <div class="result" id="totalProfit"></div>

  <div class="range-buttons">
    <button data-range="1">1D</button>
    <button data-range="30">30D</button>
    <button data-range="90">90D</button>
  </div>

  <div class="chart-container">
    <canvas id="priceChart" style="width: 100%; height: 100%;"></canvas>
  </div>

<script>
const coinSelect = document.getElementById('coinSelect');
const priceOutput = document.getElementById('priceOutput');
const marketResult = document.getElementById('marketResult');
const limitResult = document.getElementById('limitResult');
const exchangeFees = {
  crypto: { maker: 0.25, taker: 0.50 },
  kraken: { maker: 0.16, taker: 0.26 },
  binance: { maker: 0.10, taker: 0.10 },
  coinbase: { maker: 0.40, taker: 0.60 },
  kucoin: { maker: 0.10, taker: 0.10 },
  nexo: { maker: 0.00, taker: 0.50 }
};

document.getElementById('exchangeSelect').addEventListener('change', e => {
  const selected = exchangeFees[e.target.value];
  if (selected) {
    document.getElementById('makerFee').value = selected.maker;
    document.getElementById('takerFee').value = selected.taker;
    calculate();
  }
});

function calculate() {
  const currency = document.getElementById('currencySelect').value;
  const buy = parseFloat(document.getElementById('buyPrice').value);
  const maker = parseFloat(document.getElementById('makerFee').value) / 100;
  const taker = parseFloat(document.getElementById('takerFee').value) / 100;
  const profit = parseFloat(document.getElementById('profitTarget').value) / 100;
  const qty = parseFloat(document.getElementById("coinQty").value);

  if (isNaN(buy) || isNaN(qty)) return;

  const marketSell = buy * (1 + maker) * (1 + taker);
  const limitSell = buy * (1 + profit) * (1 + taker);
  const formatter = new Intl.NumberFormat(undefined, { style: "currency", currency: currency.toUpperCase() });

  marketResult.textContent = 'Market Sell Price: ' + formatter.format(marketSell);
  limitResult.textContent = 'Limit Sell Price: ' + formatter.format(limitSell);
  const profitTotal = (limitSell - buy) * qty;
  document.getElementById('totalProfit').textContent = 'Total Profit: ' + formatter.format(profitTotal);
}

const chartRangeButtons = document.querySelectorAll('.range-buttons button');
let chartRange = localStorage.getItem('chartRange') || '30';
chartRangeButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    chartRange = btn.dataset.range;
    localStorage.setItem('chartRange', chartRange);
    updateCoin();
  });
});

function setDarkMode(enabled) {
  document.body.classList.toggle('dark', enabled);
  document.getElementById('darkModeToggle').checked = enabled;
  localStorage.setItem('darkMode', enabled ? '1' : '0');
}

document.getElementById('darkModeToggle').addEventListener('change', () => {
  setDarkMode(document.getElementById('darkModeToggle').checked);
});

async function fetchPrice(coinId) {
  const currency = document.getElementById('currencySelect').value;
  const res = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${coinId}&vs_currencies=${currency}`);
  const data = await res.json();
  const formatter = new Intl.NumberFormat(undefined, { style: 'currency', currency: currency.toUpperCase() });
  priceOutput.textContent = formatter.format(data[coinId][currency]);
}

async function plotChart(coinId) {
  const currency = document.getElementById('currencySelect').value;
  const res = await fetch(`https://api.coingecko.com/api/v3/coins/${coinId}/market_chart?vs_currency=${currency}&days=${chartRange}`);
  const data = await res.json();
  const raw = data.prices;
  const interval = Math.max(1, Math.floor(raw.length / (chartRange === '1' ? 24 : chartRange === '30' ? 30 : 45)));
  const downsampled = raw.filter((_, i) => i % interval === 0);
  const labels = downsampled.map(p => new Date(p[0]).toLocaleDateString());
  const prices = downsampled.map(p => p[1]);
  const formatter = new Intl.NumberFormat(undefined, { style: 'currency', currency: currency.toUpperCase() });

  if (window.chartInstance) window.chartInstance.destroy();
  const ctx = document.getElementById('priceChart').getContext('2d');
  window.chartInstance = new Chart(ctx, {
    type: 'line',
    data: {
      labels,
      datasets: [{
        label: coinId.toUpperCase(),
        data: prices,
        borderColor: '#4bc0c0',
        tension: 0.3,
        fill: false
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      interaction: { mode: 'index', intersect: false },
      plugins: {
        tooltip: {
          callbacks: {
            label: ctx => formatter.format(ctx.raw)
          }
        }
      },
      scales: {
        y: {
          ticks: {
            callback: val => formatter.format(val)
          }
        }
      }
    }
  });
}

async function updateCoin() {
  const coinId = coinSelect.value;
  await fetchPrice(coinId);
  await plotChart(coinId);
}

window.addEventListener('load', () => {
  const savedCurrency = localStorage.getItem('currency') || 'usd';
  document.getElementById('currencySelect').value = savedCurrency;
  document.getElementById('currencySelect').addEventListener('change', () => {
    localStorage.setItem('currency', document.getElementById('currencySelect').value);
    updateCoin();
  });

  if (localStorage.getItem('darkMode') === '1') setDarkMode(true);
  updateCoin();
});
</script>
</body>
</html>
